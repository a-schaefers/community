#!/bin/sh -e

make CFLAGS="$CFLAGS -static"

install -Dm 755 sinit "$1/usr/bin/sinit"

install -Dm 755 sinit_runit.boot "$1/etc/rc.d/sinit_runit.boot"
install -Dm 755 sinit_getty.boot "$1/etc/rc.d/sinit_getty.boot"
install -Dm 755 sinit.pre.shutdown "$1/etc/rc.d/sinit.pre.shutdown"
install -Dm 755 sinit.post.shutdown "$1/etc/rc.d/sinit.post.shutdown"

if ! grep -q "SINIT_" /etc/rc.conf ; then
    cat << EOF >> /etc/rc.conf

# Uncomment and Set to 1 to enable /etc/rc.d/ scripts for sinit
# SINIT_ENABLE_SHUTDOWN_HOOKS=1   # <- (required)
# SINIT_ENABLE_GETTY=1            # <- (required)
# SINIT_ENABLE_RUNIT=1            # <- Enable the busybox-runit process supervisor (optional)

EOF
fi
